generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "mysql"
  url      = env("DATABASE_URL")
}

enum UserLevel {
  admin
  owner
  kurir
}

enum JenisPaket {
  Prasmanan
  Box
}

enum KategoriPaket {
  Pernikahan
  Selamatan
  Ulang_Tahun @map("Ulang Tahun")
  Studi_Tour  @map("Studi Tour")
  Rapat
}

enum StatusPesan {
  Menunggu_Konfirmasi @map("Menunggu Konfirmasi")
  Sedang_Diproses     @map("Sedang Diproses")
  Menunggu_Kurir      @map("Menunggu Kurir")
}

enum StatusKirim {
  Sedang_Dikirim @map("Sedang Dikirim")
  Tiba_Ditujukan @map("Tiba Ditujukan")
}

model users {
  id         BigInt    @id @default(autoincrement()) @db.UnsignedBigInt
  name       String    @db.VarChar(30)
  email      String    @unique @db.VarChar(255)
  password   String    @db.VarChar(255)
  level      UserLevel @default(admin)

  created_at DateTime  @default(now()) @db.DateTime(0)
  updated_at DateTime  @updatedAt @db.DateTime(0)

  pengirimans pengirimans[]
}

model pelanggans {
  id             BigInt  @id @default(autoincrement()) @db.UnsignedBigInt
  nama_pelanggan String  @db.VarChar(100)
  email          String  @unique @db.VarChar(255)
  password       String  @db.VarChar(255)

  tgl_lahir DateTime? @db.Date
  telepon   String?   @db.VarChar(15)
  alamat1   String?   @db.VarChar(255)
  alamat2   String?   @db.VarChar(255)
  alamat3   String?   @db.VarChar(255)
  kartu_id  String?   @db.VarChar(255)
  foto      String?   @db.VarChar(255)

  created_at DateTime @default(now()) @db.DateTime(0)
  updated_at DateTime @updatedAt @db.DateTime(0)

  pemesanans pemesanans[]
}

model pakets {
  id          BigInt        @id @default(autoincrement()) @db.UnsignedBigInt
  nama_paket  String        @db.VarChar(50)
  jenis       JenisPaket
  kategori    KategoriPaket
  jumlah_pax  Int           @db.Int
  harga_paket Int           @db.Int
  deskripsi   String        @db.Text
  foto1       String?       @db.VarChar(255)
  foto2       String?       @db.VarChar(255)
  foto3       String?       @db.VarChar(255)

  created_at DateTime @default(now()) @db.DateTime(0)
  updated_at DateTime @updatedAt @db.DateTime(0)

  detail_pemesanans detail_pemesanans[]
}

model jenis_pembayarans {
  id                BigInt @id @default(autoincrement()) @db.UnsignedBigInt
  metode_pembayaran String @db.VarChar(30)

  created_at DateTime @default(now()) @db.DateTime(0)
  updated_at DateTime @updatedAt @db.DateTime(0)

  detail_jenis_pembayarans detail_jenis_pembayarans[]
  pemesanans               pemesanans[]
}

model detail_jenis_pembayarans {
  id                  BigInt @id @default(autoincrement()) @db.UnsignedBigInt
  id_jenis_pembayaran BigInt @db.UnsignedBigInt
  no_rek              String @db.VarChar(25)
  tempat_bayar        String @db.VarChar(50)
  logo                String? @db.VarChar(255)

  created_at DateTime @default(now()) @db.DateTime(0)
  updated_at DateTime @updatedAt @db.DateTime(0)

  jenis_pembayaran jenis_pembayarans @relation(fields: [id_jenis_pembayaran], references: [id], onDelete: Cascade)

  @@index([id_jenis_pembayaran])
}

model pemesanans {
  id             BigInt     @id @default(autoincrement()) @db.UnsignedBigInt
  id_pelanggan   BigInt     @db.UnsignedBigInt
  id_jenis_bayar BigInt     @db.UnsignedBigInt
  no_resi        String     @db.VarChar(30)
  tgl_pesan      DateTime   @db.DateTime(0)
  status_pesan   StatusPesan
  total_bayar    BigInt     @db.UnsignedBigInt

  created_at DateTime @default(now()) @db.DateTime(0)
  updated_at DateTime @updatedAt @db.DateTime(0)

  pelanggan   pelanggans        @relation(fields: [id_pelanggan], references: [id], onDelete: Restrict)
  jenis_bayar jenis_pembayarans @relation(fields: [id_jenis_bayar], references: [id], onDelete: Restrict)

  detail_pemesanans detail_pemesanans[]
  pengirimans       pengirimans?

  @@index([id_pelanggan])
  @@index([id_jenis_bayar])
}

model detail_pemesanans {
  id_pemesanan BigInt @db.UnsignedBigInt
  id_paket     BigInt @db.UnsignedBigInt
  subtotal     BigInt @db.UnsignedBigInt

  created_at DateTime @default(now()) @db.DateTime(0)
  updated_at DateTime @updatedAt @db.DateTime(0)

  pemesanan pemesanans @relation(fields: [id_pemesanan], references: [id], onDelete: Cascade)
  paket     pakets     @relation(fields: [id_paket], references: [id], onDelete: Restrict)

  @@id([id_pemesanan, id_paket])
  @@index([id_paket])
}

model pengirimans {
  id          BigInt      @id @default(autoincrement()) @db.UnsignedBigInt
  tgl_kirim   DateTime    @db.DateTime(0)
  tgl_tiba    DateTime?   @db.DateTime(0)
  status_kirim StatusKirim
  bukti_foto  String?     @db.VarChar(255)
  id_pesan    BigInt      @unique @db.UnsignedBigInt
  id_user     BigInt      @db.UnsignedBigInt

  created_at DateTime @default(now()) @db.DateTime(0)
  updated_at DateTime @updatedAt @db.DateTime(0)

  pemesanan pemesanans @relation(fields: [id_pesan], references: [id], onDelete: Cascade)
  user      users      @relation(fields: [id_user], references: [id], onDelete: Restrict)

  @@index([id_user])
}
